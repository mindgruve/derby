parameters:
    media.tmp_path: /tmp/derby

services:
    # Media Manager
    media.manager:
        class: Derby\Manager

    # Imagine
    imagine.imagick:
        class: Imagine\Imagick\Imagine
    imagine.gd:
        class: Imagine\Gd\Imagine
    imagine.Gmagick:
        class: Imagine\Gmagick\Imagine

    # Media Adapters
    media.adapter.local_file:
        class: Derby\Adapter\LocalFileAdapter
        arguments: [ %media.tmp_path%, false, '0777' ]
    media.factory.audio:
        class: Derby\Media\LocalFile\AudioFactory
        arguments:
            - [ 'mp3', 'wav', 'wma' ]
            - [ 'audio/mpeg',  'audio/vnd.wave', 'audio/wav', 'audio/wave',  'audio/x-wav' ]
        tags:
            - { name: media.factory, priority: 10 }

    # Media Factories
    media.factory.document:
        class: Derby\Media\LocalFile\DocumentFactory
        arguments:
            - [ 'doc', 'rtf' ]
            - [ 'application/msword', 'text/rtf', 'application/rtf' ]
        tags:
            - { name: media.factory, priority: 10 }
    media.factory.html:
        class: Derby\Media\LocalFile\HtmlFactory
        arguments:
            - [ 'html' ]
            - [ 'text/plain', 'txt/html' ]
        tags:
            - { name: media.factory, priority: 10 }
    media.factory.image:
        class: Derby\Media\LocalFile\ImageFactory
        arguments:
            - [ 'jpg', 'jpeg', 'gif', 'bmp', 'png' ]
            - [ 'image/jpeg', 'image/gif', 'image/bmp', 'image/x-bmp', 'image/png' ]
            - @imagine.gd
        tags:
            - { name: media.factory, priority: 10 }
    media.factory.pdf:
        class: Derby\Media\LocalFile\PdfFactory
        arguments:
            - [ 'pdf' ]
            - [ 'application/pdf', 'application/x-pdf' ]
        tags:
            - { name: media.factory, priority: 10 }
    media.factory.presentation:
        class: Derby\Media\LocalFile\PresentationFactory
        arguments:
            - [ 'ppt', 'pptx' ]
            - [ 'application/vnd.ms-powerpointtd>', 'application/vnd.openxmlformats-officedocument.presentationml.presentation' ]
        tags:
            - { name: media.factory, priority: 10 }
    media.factory.spreadsheet:
        class: Derby\Media\LocalFile\SpreadsheetFactory
        arguments:
            - [ 'xls', 'xlsx', 'xlsm' ]
            - [ 'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', 'application/vnd.ms-excel.sheet.macroEnabled.12' ]
        tags:
            - { name: media.factory, priority: 10 }
    media.factory.text:
        class: Derby\Media\LocalFile\TextFactory
        arguments:
            - [ 'txt' ]
            - [ 'text/plain' ]
        tags:
            - { name: media.factory, priority: 10 }
    media.factory.video:
        class: Derby\Media\LocalFile\VideoFactory
        arguments:
            - [ 'webm', 'vob', 'ogg', 'wmv', 'avi', 'mov', 'qt', 'mp4', 'mpg',  'mpeg' ]
            - [ 'video/webm', 'video/dvd',  'video/mpeg', 'video/x-ms-vob', 'video/ogg', 'application/ogg', 'video/vnd.avi', 'video/avi', 'video/msvideo', 'video/x-msvideo', 'video/quicktime', 'video/x-ms-wmv', 'video/mp4', 'video/mpeg' ]
        tags:
            - { name: media.factory, priority: 10 }
    media.factory.local:
        class: Derby\Media\LocalFile\LocalFactory
        arguments:
            - [ '*' ]
            - [ '*' ]
        tags:
            - { name: media.factory, priority: 100 }